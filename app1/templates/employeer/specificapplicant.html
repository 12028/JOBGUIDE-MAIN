{% extends 'employeer\layouts\base.html' %}

{% block content %}
<div class="page-title">
    <div class="row">
        <div class="col-12 col-md-6 order-md-1 order-las">
            <h3>Applicants</h3>
        </div>
        
        <div class="col-12 col-md-6 order-md-2 order-first">
            <nav aria-label="breadcrumb" class='breadcrumb-header'>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'postjob' %}">All Applicants</a></li>
                </ol>
            </nav>
        </div>

    </div>

    
<div class="card">
    <div class="card-header">
        <h4 class="card-title">Applicants</h4>
    </div>

    <div class="card-body">
        <!-- Filtering Options -->
        <form id="filter-form">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="cgpa">CGPA:</label>
                    <input type="number" class="form-control" id="cgpa" name="cgpa">
                </div>
                <div class="col-md-4">
                    <label for="experience">Experience:</label>
                    <input type="number" class="form-control" id="experience" name="experience">
                </div>
                <div class="col-md-4">
                    <label for="skill">Skill:</label>
                    <input type="text" class="form-control" id="skill" name="skill">
                </div>
            </div>
            <button type="submit" class="btn btn-dark">Apply Filters</button>
        </form>
        <br><br>

        <!-- Table of Applicants -->
        <table class="table table-bordered" id="table1">
            <!-- Table Header -->
            <thead>
                <tr>
                    <th>S.No</th>
                    <th>Applicant Name</th>
                    <th>Photo</th>
                    <th>View</th>
                    <th>Resume</th>
                    <th>Experience</th>
                    <th>CGPA</th>
                    <th>Skills</th>
                </tr>
            </thead>
            
            <!-- Table Body -->
            <tbody>
                {% for applicant in sorted_applicants %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ applicant.jobseeker_name }}</td>
                        <td><img src="{{ applicant.profile_photo }}" style="width: 75px;height: 75px;"></td>
                        <td><a href="{% url 'applicantdetails' applicant.jobseeker_id applicant.application_id %}" class="btn btn-success">View</a></td>
                        <td><a href="{% url 'showpdf' applicant.application_id %}" target="_blank" class="btn btn-danger">Resume</a></td>
                        <td>{{ applicant.experience }}</td>
                        <td>{{ applicant.cgpa }}</td>
                        <td>
                            {% for skill in applicant.skills %}
                                {{ skill }}
                            {% endfor %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    $(document).ready(function() {
        $('#filter-form').on('submit', function(event) {
            event.preventDefault();
            applyFilters();
        });
        
        function applyFilters() {
            var cgpa = $('#cgpa').val();
            var experience = $('#experience').val();
            var skill = $('#skill').val();
            
            $.ajax({
                type: 'GET',
                url: window.location.href,
                data: {
                    'cgpa': cgpa,
                    'experience': experience,
                    'skill': skill
                },
                success: function(response) {
                    $('#table1 tbody').html(response);
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        }
    });
</script>
{% endblock %}
